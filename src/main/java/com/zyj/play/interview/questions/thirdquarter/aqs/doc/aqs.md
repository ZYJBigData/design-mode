[toc]

#### 一.AQS(abstract queue synchronizer)

* 字面意思：抽象的队列同步器

* 技术解释：

  <img src="../../../../../../../../../../../image/image-20210419224119928.png" alt="image-20210419224119928" style="zoom:40%;" />

* 为什么AQS是juc最重要的基石的部分呢？

  <img src="../../../../../../../../../../../image/image-20210419225650641.png" alt="image-20210419225650641" style="zoom:40%;" />

#### 二.AQS 初步

* 官网初步讲解：

<img src="../../../../../../../../../../../image/image-20210419230022461.png" alt="image-20210419230022461" style="zoom:40%;" />

* 源码：

  <img src="../../../../../../../../../../../image/image-20210419230220578.png" alt="image-20210419230220578" style="zoom:40%;" />





<img src="../../../../../../../../../../../image/image-20210419231134339.png" alt="image-20210419231134339" style="zoom:40%;" />



* AQS 的内部体系架构：

  * AQS int 变量  private volatile  int state;值为0，1  通过此值来判断是否阻塞
  * AQS的CLH队列:CLH队列是三个大神的缩写，是一个双向队列，比拟为银行客区的等待顾客

* 小总结：

  * 有阻塞就需要排队，实现排队必然需要队列
  * AQS=state变量+CLH变种的双端队列

* Node

  * waitStatus说的是每个节点的状态
  * state说的是aqs当前的阻塞转态

* 内部结构

  <img src="../../../../../../../../../../../image/image-20210420100454573.png" alt="image-20210420100454573" style="zoom:40%;" />

* 属性说明

  <img src="../../../../../../../../../../../image/image-20210420102735834.png" alt="image-20210420102735834" style="zoom:40%;" />

<img src="../../../../../../../../../../../image/image-20210420102905936.png" alt="image-20210420102905936" style="zoom:40%;" />





* 源码解读

  * Lock接口的实现类，基本都是通过聚合了一个队列同步器的子类完成线程访问控制的

    <img src="../../../../../../../../../../../image/image-20210420104731528.png" alt="image-20210420104731528" style="zoom:40%;" />

  * 非公平锁走起，方法lock

    <img src="../../../../../../../../../../../image/image-20210420105058419.png" alt="image-20210420105058419" style="zoom:40%;" />

    <img src="../../../../../../../../../../../image/image-20210420105430408.png" alt="image-20210420105430408" style="zoom:40%;" />

  * 总结

    <img src="../../../../../../../../../../../image/未命名文件.png" alt="未命名文件" style="zoom:50%;" />

